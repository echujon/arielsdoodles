<style>
    #gokitty ul,
    #gokitty ol {
        text-align: left;
        margin: 0 0 1rem;
    }

    #gokitty ol li {
        list-style-type: decimal;
        margin: 0px;
    }

    #gokitty ul>li,
    #gokitty ul li>ul>li>ul>li {
        list-style-type: disc;
        margin: 0px;
    }

    #gokitty ul li>ul>li {
        list-style-type: circle;
        margin: 0px;
    }

    #gokitty table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
        margin: 1em 0;
        border-collapse: collapse;
        width: 100%;
    }

    #gokitty table th,
    #gokitty table td {
        padding: 0.5em 1em;
        border: 1px solid #ddd;
        text-align: left;
    }

    #gokitty table th {
        font-weight: bold;
    }

    @media only screen and (max-width: 768px) {
        #gokitty table {
            font-size: 0.9em;
        }

        #gokitty table th,
        #gokitty table td {
            padding: 0.4em 0.6em;
        }
    }

    .suit img {
        width: 1em;
        height: 1em;
        vertical-align: middle;
        margin-bottom: .1em;
    }

    .season-list {
        white-space: nowrap;
    }

    .season-list .suit {
        display: inline-block;
    }

    .kitty-card img {
        width: 6em;
        display: block;
        margin: 0 auto .1em auto;
        cursor: pointer;
        border: 2px solid #ddd;
        border-radius: 4px;
    }

    .mouse-card img {
        margin: 0 0 .1em 0;
        cursor: pointer;
        border: 2px solid #ddd;
        border-radius: 4px;
    }

    .suit img {
        border: none !important;
    }

    /* Modal styles - matching portfolio lightbox */
    .kitty-modal {
        display: flex;
        align-items: center;
        justify-content: center;
        pointer-events: none;
        user-select: none;
        transition: opacity 0.5s ease, visibility 0.5s, z-index 0.5s;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        outline: 0;
        background-color: rgba(0, 0, 0, 0.925);
        visibility: hidden;
        opacity: 0;
        z-index: 0;
    }

    .kitty-modal.visible {
        pointer-events: auto;
        visibility: visible;
        opacity: 1;
        z-index: 10001;
    }

    .kitty-modal:after {
        content: '';
        display: block;
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        width: 4rem;
        height: 4rem;
        cursor: pointer;
        background-image: url('data:image/svg+xml;charset=utf8,<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64"><line x1="20" y1="20" x2="44" y2="44" stroke="white" stroke-width="1.5"/><line x1="20" y1="44" x2="44" y2="20" stroke="white" stroke-width="1.5"/></svg>');
        background-position: center;
        background-repeat: no-repeat;
        background-size: 3rem;
    }

    .kitty-modal .inner {
        transform: translateY(0.75rem);
        transition: opacity 0.25s ease, transform 0.25s ease;
        opacity: 0;
        text-align: center;
    }

    .kitty-modal.loaded .inner {
        transform: translateY(0);
        transition: opacity 0.5s ease, transform 0.5s ease;
        opacity: 1;
    }

    .kitty-modal .inner img {
        display: block;
        max-width: 90vw;
        max-height: 85vh;
        box-shadow: 0 1rem 3rem 0 rgba(0, 0, 0, 0.35);
        border-radius: 4px;
    }

    .kitty-modal .inner .title {
        color: #fff;
        font-size: 1.5em;
        font-weight: bold;
        margin-bottom: 1em;
    }

    .kitty-modal .inner .name {
        color: #fff;
        font-size: 1.5em;
        font-weight: bold;
        margin-top: 1em;
    }

    @media only screen and (max-width: 768px) {
        .kitty-modal .inner img {
            max-width: 100vw;
        }
    }

    @media only screen and (max-width: 768px) {
        .kitty-card img {
            width: 4em;
        }
    }

    #gokitty h1 {
        text-align: center;
    }

    #gokitty .collapsible-section h1 {
        text-align: left;
        cursor: pointer;
        position: relative;
        padding-left: 2rem;
        user-select: none;
    }

    #gokitty .collapsible-section h1::after {
        content: 'â–¼';
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        transition: transform 0.3s ease;
        font-size: 0.5em;
    }

    #gokitty .collapsible-section h1.collapsed::after {
        transform: translateY(-50%) rotate(-90deg);
    }

    #gokitty .collapsible-content {
        overflow: hidden;
        transition: max-height 0.5s ease, opacity 0.3s ease;
        max-height: 10000px;
        opacity: 1;
    }

    #gokitty .collapsible-content.collapsed {
        max-height: 0;
        opacity: 0;
    }

    #gokitty .collapsible-content p {
        text-align: left;
    }

    @media only screen and (min-width: 551px) {
        .suit {
            display: inline-block;
        }
    }

    @media only screen and (max-width: 550px) {
        .suit {
            display: block;
        }

        #gokitty .collapsible-content ul li,
        #gokitty > div > ul li {
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
    }

    /* Print-friendly styles */
    @media print {
        /* Hide navigation and non-content elements */
        nav, .hamburger, .nav-menu, footer, .kitty-modal, #navbar {
            display: none !important;
        }

        /* Ensure content uses full width */
        body, html {
            width: 100%;
            margin: 0;
            padding: 0;
        }

        #gokitty {
            max-width: 100%;
            margin: 0;
            padding: 1cm;
        }

        /* Expand all collapsible sections for printing */
        #gokitty .collapsible-content {
            max-height: none !important;
            opacity: 1 !important;
        }

        /* Hide collapse indicators */
        #gokitty .collapsible-section h1::after {
            display: none;
        }

        /* Optimize page breaks */
        h1, h2, h3 {
            page-break-after: avoid;
            page-break-inside: avoid;
        }

        /* Allow tables to break across pages to prevent large blank spaces */
        table {
            page-break-inside: auto;
        }

        /* Keep table rows together when possible */
        table tr {
            page-break-inside: avoid;
        }

        /* Allow lists to break if needed */
        ul, ol {
            page-break-inside: auto;
        }

        /* Keep list items together */
        li {
            page-break-inside: avoid;
        }

        /* Ensure good contrast */
        body {
            background: white;
            color: black;
        }

        /* Remove backgrounds to save ink */
        * {
            background: transparent !important;
            box-shadow: none !important;
        }

        /* Optimize images for print */
        .kitty-card img, .mouse-card img {
            max-width: 4cm;
            border: 1px solid #000;
            page-break-inside: avoid;
        }

        .suit img {
            width: 0.5cm;
            height: 0.5cm;
            border: none !important;
        }

        /* Ensure tables are readable */
        #gokitty table {
            width: 100%;
            border-collapse: collapse;
            page-break-inside: auto;
        }

        #gokitty table th,
        #gokitty table td {
            border: 1px solid #000;
            padding: 0.3cm;
        }

        #gokitty table th {
            background: #f0f0f0 !important;
            font-weight: bold;
        }

        /* Ensure links show their URLs */
        a[href]:after {
            content: " (" attr(href) ")";
            font-size: 0.8em;
        }

        /* But hide URLs for anchor links and image links */
        a[href^="#"]:after,
        a[href*="images/"]:after {
            content: "";
        }

        /* Add page breaks between major sections */
        hr {
            page-break-after: always;
            border: none;
            margin: 0;
            padding: 0;
        }

        /* Optimize font sizes for print */
        body {
            font-size: 11pt;
            line-height: 1.5;
        }

        h1 {
            font-size: 18pt;
        }

        h2 {
            font-size: 14pt;
        }

        h3 {
            font-size: 12pt;
        }
    }
</style>
<section class="spotlight {{ .style }}" {{ with .id }} id="{{ . }}" {{ end }}>
    <div class="actual-content">
        <h1 class="doodles-font">{{ .Title }}</h1>
        <div id="gokitty-content">
            {{ .Content | safeHTML }}
        </div>
    </div>
</section>

<!-- Modal for kitty card images -->
<div id="kittyModal" class="kitty-modal" tabindex="-1">
    <div class="inner">
        <span class="title doodles-font" id="kittyModalTitle"></span>
        <img id="kittyModalImage" src="" alt="">
        <span class="name doodles-font" id="kittyModalName"></span>
    </div>
</div>

<script>
// Modal functions - matching portfolio lightbox behavior
(function() {
    const modal = document.getElementById('kittyModal');
    const modalImage = document.getElementById('kittyModalImage');
    const modalTitle = document.getElementById('kittyModalTitle');
    const modalName = document.getElementById('kittyModalName');
    let modalLocked = false;

    function openKittyModal(imageSrc, imageName) {
        if (modalLocked) return;

        modalLocked = true;

        // Set image source and title/name
        modalImage.src = imageSrc;
        modalTitle.textContent = imageName;
        modalName.textContent = imageName;

        // Show modal
        modal.classList.add('visible');

        // Wait for image to load then add loaded class
        modalImage.onload = function() {
            setTimeout(() => {
                modal.classList.add('loaded');
                modalLocked = false;
            }, 50);
        };

        // Focus modal
        modal.focus();
    }

    function closeKittyModal() {
        if (modalLocked) return;
        if (!modal.classList.contains('visible')) return;

        modalLocked = true;

        // Remove loaded class first for transition
        modal.classList.remove('loaded');

        // Then remove visible after a delay
        setTimeout(() => {
            modal.classList.remove('visible');
            modalImage.src = '';
            modalTitle.textContent = '';
            modalName.textContent = '';
            modalLocked = false;
        }, 350);
    }

    // Close modal when clicking on it (but not the image)
    modal.addEventListener('click', function(e) {
        if (e.target === modal || e.target === modal.querySelector('.inner')) {
            closeKittyModal();
        }
    });

    // Prevent click on image from closing modal
    modalImage.addEventListener('click', function(e) {
        e.stopPropagation();
    });

    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeKittyModal();
        }
    });

    // Close modal when scrolling
    window.addEventListener('scroll', function() {
        if (modal.classList.contains('visible')) {
            closeKittyModal();
        }
    });

    // Collapsible sections
    const content = document.getElementById('gokitty-content');
    if (!content) return;

    // Find all h1 elements that start sections (Go Kitty: Classic and Go Kitty: Pounce!)
    const h1Elements = content.querySelectorAll('h1');

    h1Elements.forEach((h1, index) => {
        // Create wrapper for collapsible section
        const wrapper = document.createElement('div');
        wrapper.className = 'collapsible-section';

        // Insert wrapper before h1
        h1.parentNode.insertBefore(wrapper, h1);

        // Move h1 into wrapper
        wrapper.appendChild(h1);

        // Create content container
        const contentDiv = document.createElement('div');
        contentDiv.className = 'collapsible-content';
        wrapper.appendChild(contentDiv);

        // Move all elements after h1 until next h1 or hr into content div
        let nextElement = wrapper.nextElementSibling;
        while (nextElement && nextElement.tagName !== 'H1' && nextElement.tagName !== 'HR') {
            const current = nextElement;
            nextElement = nextElement.nextElementSibling;
            contentDiv.appendChild(current);
        }

        // If there's an HR after this section, skip it but don't include it
        if (nextElement && nextElement.tagName === 'HR') {
            // Keep the HR in place (don't move it)
        }

        // Add click handler to toggle
        h1.addEventListener('click', function() {
            this.classList.toggle('collapsed');
            contentDiv.classList.toggle('collapsed');
        });
    });

    // Add click handlers to all kitty card images (including mouse)
    const allCardImages = document.querySelectorAll('.kitty-card img, .mouse-card img');
    allCardImages.forEach(img => {
        img.addEventListener('click', function(e) {
            e.preventDefault();
            const imageSrc = this.src;

            // Check if this is a mouse card
            const isMouseCard = this.closest('.mouse-card');

            if (isMouseCard) {
                // For mouse card, just use "Mouse" as the name
                openKittyModal(imageSrc, 'Mouse');
                return;
            }

            // For kitty cards, get the name from the parent td element
            const tdElement = this.closest('td');
            let imageName = '';

            if (tdElement) {
                // Get all text nodes from the td, excluding the img
                const clone = tdElement.cloneNode(true);
                const spans = clone.querySelectorAll('.kitty-card');
                spans.forEach(span => span.remove());
                imageName = clone.textContent.trim();
            }

            // Fallback to filename if no text found
            if (!imageName) {
                imageName = this.src.split('/').pop().split('.')[0];
            }

            openKittyModal(imageSrc, imageName);
        });
    });
})();
</script>